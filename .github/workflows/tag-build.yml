name: build-and-release
on: [push]
jobs: 
  build-all: 
    runs-on: windows-2022
    defaults: 
      run: 
        shell: pwsh
        working-directory: C:\build
    steps: 
      - uses: jwlawson/actions-setup-cmake@v1.9
        with: 
          cmake-version: '3.22.x'
      - uses: actions/checkout@v2
        with: 
          path: project
          submodules: 'recursive'
      - uses: jurplel/install-qt-action@v2
        with:
          version: '6.2.0'
          host: 'windows'
          target: 'desktop'
          arch: 'win64_msvc2019_64'
          dir: 'C:\'
      - uses: teatimeguest/setup-texlive-action@v2.0.2
      - uses: nikeee/setup-pandoc@v1
      - run: cmake -GNinja -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=C:\sniffer $env:GITHUB_WORKSPACE\project
      - run: cmake --build . --parallel
      - run: cmake --install .
      - run: cmake -E tar "cfv" C:\sniffer.zip --format=zip C:\sniffer
      - uses: softprops/action-gh-release@v1
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: C:\sniffer.zip